<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"><title>jQuery UI Touch Punch - Mobile Device Touch Event Support for jQuery UI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">

	<link rel="stylesheet" type="text/css" href="css/dragdrop3.css" />
	<link rel="stylesheet" type="text/css" href="stopwatch3.css" media="all" />
	
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/ui/1.8.21/jquery-ui.min.js"></script>
	<script type="text/javascript" src="https://raw.github.com/furf/jquery-ui-touch-punch/master/jquery.ui.touch-punch.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>

  <script>
  $(function(){
    var socket = io.connect();
    socket.on('connect', function () {

			
			socket.on('splitsdatalive', function(thesplittimes) {
			// need to convert object
console.log('viewdata html real time display');
console.log(thesplittimes);	
			splitjsondata =  JSON.parse(thesplittimes);
console.log(splitjsondata);
			formatlive = new MasterWatch();

theevent = splitjsondata['swimstatus']['swimdate'] + ' ' + splitjsondata['swimstatus']['swimdistance'] + ' ' + splitjsondata['swimstatus']['swimsplit'] + ' ' + splitjsondata['swimstatus']['swimstroke'] + ' ' + splitjsondata['swimstatus']['swimtechnique'];
			
				$('<li></li>').text(theevent).prependTo($('#swimdatalive'));
					thesplitdiff = '';
					lastsplitforcompare = '';
					lasttimefornextcalc = '';
					actualsplitdiff = '';
					// itterate over each live swimmer
					var swimids = Object.keys(splitjsondata['splitdata']);
					swimids.forEach(function(perswimmer) {
					// reset for new swimmer
						lastsplitforcompare = '';
						lasttimefornextcalc = '';
						shortsplit = '';
						// add a line of space between swimmers
						$('<li></li>').prependTo($('#swimdatalive'));
						
					// itterate over each array split and format
						splitjsondata['splitdata'][perswimmer].forEach(function (speratesplit) {
		
						// do some maths to get difference, if higher colour red, lower colour green
						// if not first number
console.log(speratesplit);	
console.log(lastsplitforcompare);	
						thesplitdiff = (speratesplit - lasttimefornextcalc) - lastsplitforcompare;
console.log(thesplitdiff);			
						actualsplitdiff = (speratesplit - lasttimefornextcalc);
						if(thesplitdiff > 0 ) {
						thecolourdiff = 'red'; }
						else {
						thecolourdiff = 'green'; }
console.log(thecolourdiff);						
						// last split to keep
						lastsplitforcompare = thesplitdiff;
						lasttimefornextcalc = speratesplit;
						var shortsplit =formatlive.format(actualsplitdiff).slice(4,11);
						
						formsplit = '<li>' + perswimmer + '  ' + formatlive.format(speratesplit) + ' ' + 'split ' + shortsplit + '</li>';
						$(formsplit).css("color", thecolourdiff).prependTo($('#swimdatalive'));
						thecolourdiff = '';
						});
					});
      });
			
      socket.on('disconnect', function() {
        $('#swimdatalive').append('<li>Disconnected</li>');
      });
    });

  });
  </script>


	</head>
	
	<body>
	<div class="container">
	<h1>Real time swim display</h1>
	<div id="messagelive"></div>
  <div class="swimeventlive"></div>
	<div id="swimdatalive"></div>

  </div> <!-- closes container-->

		<script type="text/javascript" src="jquery.scrollTo-min.js"></script>
		<script type="text/javascript" src="stopwatch3.js"></script>

  </body>
  </html>
  